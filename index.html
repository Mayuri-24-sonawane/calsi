<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculator</title>
  <style>
    :root{
      --bg:#0f172a;           /* slate-900 */
      --panel:#111827;        /* gray-900 */
      --surface:#1f2937;      /* gray-800 */
      --accent:#22c55e;       /* green-500 */
      --accent-pressed:#16a34a; /* green-600 */
      --text:#e5e7eb;         /* gray-200 */
      --muted:#9ca3af;        /* gray-400 */
      --danger:#ef4444;       /* red-500 */
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }

    *{ box-sizing: border-box; }
    html,body{
      height:100%;
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 20% 0%, #111827 0%, #0b1225 40%, #0a0f20 100%);
      color: var(--text);
    }

    .wrap{
      min-height:100%;
      display:grid;
      place-items:center;
      padding:24px;
    }

    .calc{
      width:min(92vw, 420px);
      background: linear-gradient(180deg, var(--panel), #0d1324 60%);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.06);
    }

    .brand{
      display:flex;align-items:center;justify-content:space-between;
      padding:16px 18px 0 18px;
      color:var(--muted);
      font-size:12px; letter-spacing:.12em; text-transform:uppercase;
    }

    .display{
      padding:12px 18px 4px 18px;
      text-align:right;
      font-variant-numeric: tabular-nums;
    }

    .history{ min-height:24px; color:var(--muted); font-size:14px; }
    .value{ font-size:44px; line-height:1; padding-block:8px 2px; word-wrap:anywhere; }

    .keys{
      background: rgba(255,255,255,.02);
      padding:16px;
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:12px;
    }

    button{
      appearance:none; border:0; outline:0; cursor:pointer;
      padding:18px 14px; border-radius:14px; font-size:18px; color:var(--text);
      background: linear-gradient(180deg, var(--surface), #151c2b);
      box-shadow: inset 0 -2px 0 rgba(255,255,255,.04), 0 6px 14px rgba(0,0,0,.35);
      transition: transform .04s ease, filter .2s ease, background .2s ease;
      user-select:none;
    }
    button:active{ transform: translateY(1px) scale(.998); }

    .op{ background: linear-gradient(180deg, #243042, #1a2333); }
    .accent{ background: linear-gradient(180deg, var(--accent), var(--accent-pressed)); color:#04200f; font-weight:700; }
    .danger{ background: linear-gradient(180deg, #2a1214, #3a0e11); color:#fecaca; }

    .span-2{ grid-column: span 2; }

    /* Accessibility */
    button:focus-visible{ outline:2px solid #60a5fa; outline-offset:2px; }

    .footer{
      text-align:center; color:var(--muted); font-size:12px; padding:0 0 12px;
    }
    .kbd{ font-family: ui-monospace, SFMono-Regular, Menlo, monospace; background:#0b1220; border:1px solid rgba(255,255,255,.08); padding:2px 6px; border-radius:6px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="calc" role="application" aria-label="basic calculator">
      <div class="brand"><span>CALCULATOR</span><span>JS • CSS • HTML</span></div>
      <div class="display">
        <div id="history" class="history" aria-live="polite"></div>
        <div id="display" class="value" aria-live="assertive">0</div>
      </div>
      <div class="keys" id="keys">
        <button class="danger" data-action="clear" aria-label="Clear">AC</button>
        <button data-action="delete" aria-label="Delete last">DEL</button>
        <button class="op" data-op="%" aria-label="Percent">%</button>
        <button class="op" data-op="/" aria-label="Divide">÷</button>

        <button data-digit="7">7</button>
        <button data-digit="8">8</button>
        <button data-digit="9">9</button>
        <button class="op" data-op="*" aria-label="Multiply">×</button>

        <button data-digit="4">4</button>
        <button data-digit="5">5</button>
        <button data-digit="6">6</button>
        <button class="op" data-op="-" aria-label="Subtract">−</button>

        <button data-digit="1">1</button>
        <button data-digit="2">2</button>
        <button data-digit="3">3</button>
        <button class="op" data-op="+" aria-label="Add">+</button>

        <button data-action="negate" aria-label="Plus or minus">±</button>
        <button data-digit="0" class="span-2">0</button>
        <button data-action="decimal">.</button>
        <button class="accent" data-action="equals" aria-label="Equals">=</button>
      </div>
      <div class="footer">Keyboard: <span class="kbd">0-9</span> <span class="kbd">.</span> <span class="kbd">+−×÷</span> <span class="kbd">%</span> <span class="kbd">Enter</span> <span class="kbd">Backspace</span> <span class="kbd">Esc</span></div>
    </div>
  </div>

  <script>
    // Calculator state
    const state = {
      displayValue: '0',
      firstOperand: null,
      operator: null,
      waitingForSecondOperand: false,
      history: ''
    };

    const display = document.getElementById('display');
    const historyEl = document.getElementById('history');

    function updateDisplay(){
      display.textContent = state.displayValue;
      historyEl.textContent = state.history;
    }

    function inputDigit(digit){
      if(state.waitingForSecondOperand){
        state.displayValue = digit;
        state.waitingForSecondOperand = false;
      } else {
        state.displayValue = state.displayValue === '0' ? digit : state.displayValue + digit;
      }
      updateDisplay();
    }

    function inputDecimal(){
      if(state.waitingForSecondOperand){
        state.displayValue = '0.';
        state.waitingForSecondOperand = false;
        updateDisplay();
        return;
      }
      if(!state.displayValue.includes('.')){
        state.displayValue += '.';
        updateDisplay();
      }
    }

    function clearAll(){
      state.displayValue = '0';
      state.firstOperand = null;
      state.operator = null;
      state.waitingForSecondOperand = false;
      state.history = '';
      updateDisplay();
    }

    function deleteLast(){
      if(state.waitingForSecondOperand) return; // nothing to delete
      const s = state.displayValue.toString();
      state.displayValue = s.length > 1 ? s.slice(0,-1) : '0';
      updateDisplay();
    }

    function negate(){
      if(state.displayValue === '0') return;
      if(state.displayValue.startsWith('-')) state.displayValue = state.displayValue.slice(1);
      else state.displayValue = '-' + state.displayValue;
      updateDisplay();
    }

    function percent(){
      const v = parseFloat(state.displayValue);
      if(!isNaN(v)){
        state.displayValue = String(trimFloat(v / 100));
        updateDisplay();
      }
    }

    function handleOperator(nextOp){
      const inputValue = parseFloat(state.displayValue);

      if(state.operator && state.waitingForSecondOperand){
        // Replace operator if user taps operators consecutively
        state.operator = nextOp;
        state.history = formatHistory(state.firstOperand, state.operator);
        updateDisplay();
        return;
      }

      if(state.firstOperand === null){
        state.firstOperand = inputValue;
      } else if(state.operator){
        const result = calculate(state.firstOperand, inputValue, state.operator);
        state.displayValue = String(trimFloat(result));
        state.firstOperand = result;
      }

      state.operator = nextOp;
      state.waitingForSecondOperand = true;
      state.history = formatHistory(state.firstOperand, state.operator);
      updateDisplay();
    }

    function equals(){
      const inputValue = parseFloat(state.displayValue);
      if(state.operator === null || state.firstOperand === null || state.waitingForSecondOperand){
        return; // nothing to evaluate
      }
      const result = calculate(state.firstOperand, inputValue, state.operator);
      state.displayValue = String(trimFloat(result));
      state.history = '';
      state.firstOperand = null;
      state.operator = null;
      state.waitingForSecondOperand = false;
      updateDisplay();
    }

    function calculate(a, b, op){
      switch(op){
        case '+': return a + b;
        case '-': return a - b;
        case '*': return a * b;
        case '/': return b === 0 ? NaN : a / b;
        case '%': return a % b; // fallback if used as binary op via keyboard
        default: return b;
      }
    }

    function trimFloat(num){
      // Avoid long floating artifacts (e.g., 0.1 + 0.2)
      const rounded = Math.round((num + Number.EPSILON) * 1e12) / 1e12;
      // Remove trailing zeros
      return parseFloat(rounded.toString());
    }

    function formatHistory(first, op){
      const opMap = { '*':'×', '/':'÷', '+':'+', '-':'−', '%':'%' };
      return `${first} ${opMap[op] ?? op}`.trim();
    }

    // Click handling
    document.getElementById('keys').addEventListener('click', (e)=>{
      const btn = e.target.closest('button');
      if(!btn) return;

      if(btn.dataset.digit){ inputDigit(btn.dataset.digit); return; }
      if(btn.dataset.action === 'decimal'){ inputDecimal(); return; }
      if(btn.dataset.action === 'clear'){ clearAll(); return; }
      if(btn.dataset.action === 'delete'){ deleteLast(); return; }
      if(btn.dataset.action === 'negate'){ negate(); return; }
      if(btn.dataset.action === 'equals'){ equals(); return; }
      if(btn.dataset.op){
        if(btn.dataset.op === '%'){ percent(); return; }
        handleOperator(btn.dataset.op);
      }
    });

    // Keyboard support
    window.addEventListener('keydown', (e)=>{
      const { key } = e;
      if(/^[0-9]$/.test(key)) { inputDigit(key); return; }
      if(key === '.') { inputDecimal(); return; }
      if(key === '+' || key === '-' || key === '*' || key === '/') { handleOperator(key); return; }
      if(key === '%') { percent(); return; }
      if(key === 'Enter' || key === '=') { e.preventDefault(); equals(); return; }
      if(key === 'Backspace') { deleteLast(); return; }
      if(key === 'Escape') { clearAll(); return; }
    });

    updateDisplay();
  </script>
</body>
</html>
